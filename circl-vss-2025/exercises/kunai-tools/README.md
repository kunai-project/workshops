## Using Kunai Tools

### Learning Objectives
- Get basic knowledge about external tools to make your life easier
- Learn how to recursively search process activity
- Learn how to assess the log volume generated by Kunai

### Searching Process Activity

> ℹ️ The process of searching the activity related to a given process is very important as it
> allow to isolate a process activity. It is a fundamental step to master to build **detection
> rules**.

1. Run kunai
   
   ```bash
   sudo kunai | tee /tmp/kunai.json
   ```
1. In a separate terminal run another command (`/bin/ls` for example)

   ```bash
   ls -hail
   ```
   
1. Stop kunai by hitting `CTRL+C`

1. Search for your binary's activity with a recursive search

    ```bash
    # search with binary file (possible only if file is on the same machine)
    kunai-search -F /bin/ls /tmp/kunai.json
    
    # search by hash
    kunai-search -c $LS_HASH /tmp/kunai.json
    
    # search by process guuid
    kunai-search -g $LS_GUUID /tmp/kunai.json
    ```

> ⚠️ Some execution indirection **might cause** kunai-search to loose the track of execution.
> For example a service being created and started (the parent of the process started would no
> longer be the process we track).

### Seeing events throughput

> ℹ️ Being able to assess events throughput is very important when sizing storage backend.
> Thanks to this assessment you can adjust your log filtering policies.

* Run `kunai-stats` on **previous trace file**
   
   ```bash
   kunai-stats /tmp/kunai.json
   ```

* Run `kunai-stats` on **live kunai run**
    
   ```bash
   # -r 25 means refresh output every 25 events
   sudo kunai | kunai-stats -r 25 -
   ```
